#!/bin/bash

# mise config hash: {{ include "dot_config/mise/config.toml" | sha256sum }}

[ -n "${DEBUG:-}" ] && set -o xtrace
set -o errexit
set -o nounset

# Only run if mise is available
if ! command -v mise >/dev/null 2>&1; then
    echo "mise not found, skipping tool installation"
    exit 0
fi

echo "Installing global mise tools..."

# Install all tools defined in global config
# Authenticate with GitHub via gh CLI to avoid API rate limits
{{- if lookPath "gh" }}
GITHUB_TOKEN=$(gh auth token) mise install --yes
{{- else }}
mise install --yes
{{- end }}

echo "Pruning unused mise tool versions and stale caches..."
mise prune --yes
mise cache prune

echo "Global mise tools installation complete"
