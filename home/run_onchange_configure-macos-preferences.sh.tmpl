{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash

[ -n "${DEBUG:-}" ] && set -o xtrace
set -o errexit
set -o nounset

# Disable Spotlight's Cmd+Space (HotKey 64)
# Parameters: ASCII 32 (space), virtual keycode 49 (space), modifiers 1048576 (Cmd)
if [ "$(plutil -extract AppleSymbolicHotKeys.64.enabled raw -o - ~/Library/Preferences/com.apple.symbolichotkeys.plist 2>/dev/null)" = "false" ]; then
    echo "Spotlight Cmd+Space already disabled, skipping"
else
    echo "Disabling Spotlight Cmd+Space..."
    defaults write com.apple.symbolichotkeys AppleSymbolicHotKeys -dict-add 64 \
        '<dict>
            <key>enabled</key><false/>
            <key>value</key>
            <dict>
                <key>parameters</key>
                <array>
                    <integer>32</integer>
                    <integer>49</integer>
                    <integer>1048576</integer>
                </array>
                <key>type</key><string>standard</string>
            </dict>
        </dict>'
    /System/Library/PrivateFrameworks/SystemAdministration.framework/Resources/activateSettings -u
    echo "Spotlight Cmd+Space disabled"
fi

# Set Raycast hotkey to Cmd+Space
# Best-effort: may not apply if Raycast is running (cached prefs overwrite on quit)
current="$(defaults read com.raycast.macos raycastGlobalHotkey 2>/dev/null || true)"
if [ "$current" = "Command-49" ]; then
    echo "Raycast Cmd+Space already set, skipping"
else
    echo "Setting Raycast hotkey to Cmd+Space..."
    defaults write com.raycast.macos raycastGlobalHotkey "Command-49"
    echo "Raycast hotkey set"
fi

# Set wallpaper to Monterey Graphic
wallpaper="/System/Library/Desktop Pictures/Monterey Graphic.madesktop"
current_wallpaper="$(osascript -e 'tell application "System Events" to get picture of every desktop' 2>/dev/null | head -1 || true)"
if [ "$current_wallpaper" = "$wallpaper" ]; then
    echo "Wallpaper already set to Monterey Graphic, skipping"
else
    echo "Setting wallpaper to Monterey Graphic..."
    osascript -e "tell application \"System Events\" to set picture of every desktop to \"$wallpaper\""
    echo "Wallpaper set"
fi
{{ end -}}
